<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <title>Program 9, CSci 39542: Data Science, Hunter College</title>
</head>
<STYLE>A {text-decoration: none;}
th, td { padding: 5px; }
code {
  background-color: #eeeeee;
}
.inline {
  padding: 1px;
}
.blockcode {
  border: 1px solid #999999;
  display: block;
  padding-left: 10px;
  padding-top : 2px;
  padding-bottom : 2px;
  margin: 5px;
}
.datablock {
  border: 1px solid #eeeeee;
  display: block;
  padding: 7px;
  padding-top : 0px;
  margin: 5px;
}
</STYLE>
<body>


<div style="margin: 15px;width=100%;">
    <span style= "float: left;font-size:larger"><a href="index.html">CSci 39542</a></span>
    <span style= "float: right">
      <a href="syl.html">Syllabus</a>&nbsp;&nbsp;&nbsp;
      <a href="resources.html">Resources</a>&nbsp;&nbsp;&nbsp;
      <a href="work.html">Coursework</a><!--&nbsp;&nbsp;&nbsp;
      <a href="faq.html">FAQ</a>-->
    </span>
</div>

<br>
<br>
<hr>

<div style="margin:50px">


<h2>Program 9:  Logistic Taxi
  <br>CSci 39542: Introduction to Data Science<br>
<a href="http://www.hunter.cuny.edu/csci">Department of Computer Science</a><br>
<a href="https://hunter.cuny.edu">Hunter College</a>, <a href="https://www.cuny.edu">City University of New York</a><br>
Spring 2022<br><br>
</h2>


<hr>
<a href="work.html#cw">Classwork</a>&nbsp;&nbsp;&nbsp;
<a href="work.html#quizzes">Quizzes</a>&nbsp;&nbsp;&nbsp;
<a href="work.html#hw">Homework</a>&nbsp;&nbsp;&nbsp;
<a href="work.html#project">Project</a>&nbsp;&nbsp;&nbsp;
<hr>

<p>
<h3>General Notes</h3>

<p>This program builds on the concepts and code developed during lecture and through the reading.  Mastery of material is assessed via
<ul>
  <li> Autograding of the program submitted to Gradescope, and
  <li> Completion of a timed coding quiz on the material.  See <a href="work.html#quizzes">Quizzes</a> for details.
</ul>

Solutions to both will be available on Blackboard (<tt>Course Materials : Solutions</tt>) an hour after their respective deadline.

<h4>Autograder Notes</h4>

<p> Submitted code must be in Python, using only the specified libraries.  The autograder expects a <code class="inline">.py</code> file and does not accept iPython notebooks.
Also, to receive full credit, the code should be compatible with Python 3.6 (the default for the Gradescope autograders).

<p>To encourage starting early on programs, bonus points are given for early submission.  A point a day, up to a total of 3 bonus points (10% of the program grade), are possible.  The points are prorated by hour.  For example, if you turn in the program 36 hours early, then the bonus poins are: (36 hours/3 days)*3 points = (36 hours/72 hours)*3 points = 1.5 points.

<p>
To get full credit for a program, the file must include in the opening comment:
<ul>
    <li> Your name, as it appears in your Gradescope registration.
    <li> The email you are using for Gradescope.
    <li> A list of any resources you used for the program.  Include classmates and tutors that you worked with, along with any websites or tutorials that you used.  If you used no resources (other than the class notes and textbooks), then you should include the line:  "No resources used."
</ul>



<br>
<br>
<br>
<hr>

<h2>Program Description</h2>

<br>
   <p><a name="p9"><b>Program 9: Logistic Taxis.</b></b> &emsp; <i>Due noon, Thursday, 7 April.
     <br>Learning Objective: give students practice on implementing model from start to finish and to strengthen understanding of model drift.
     <br>Available Libraries: pandas, datetime, pickle, sklearn, and core Python 3.6+.<br>
     Data Source: <a href="https://data.cityofnewyork.us/Transportation/2020-For-Hire-Vehicles-Trip-Data/m3yx-mvk4">Yellow Taxi Trip Data</a> from OpenData NYC
     and ADD IN ZONE/BORO table.<br>
     Sample Datasets:  <a href="../fall21/taxi_new_years_day_2020.csv">taxi_new_years_day_2020.csv</a>,
      <a href="../fall21/taxi_new_years_day_2020.csv">taxi_4July2020.csv</a>,
      JFK TAXI, ZONE/BORO.<br></i>

<p>Have some regulation here?

Start with adding indicator variables, then building logistic model, wo Regularization and with regularization.  Then save models as pkl files to use/compare for later.

Add confusion matrices in here, as well as additional indicator variables, and transforms.

Compute length of trip, add in dummies?

Have the indicator be paid toll.  Build a logistic regression that captures this.
Multiple inputs?

<ul>
    <li> <code class = "inline">import_data(file_name) -> pd.DataFrame:</code>
      This function takes as one input parameter:
      <ul>
        <li> <code class = "inline">file_name</code>: the name of a CSV file containing <a href="https://data.cityofnewyork.us/Transportation/2020-For-Hire-Vehicles-Trip-Data/m3yx-mvk4">Yellow Taxi Trip Data</a> from OpenData NYC.
      </ul>
      The data in the file is read into a DataFrame, and the resulting DataFrame is returned.  (Note this is identical to the function with the same name in <a href="p8.html">Program 8</a>.  You may use your earlier function or the Program 8 solution available on Blackboard.)

      <li> <code class = "inline">add_tip_time_features(df) -> pd.DataFrame:</code>
        This function takes one input:
        <ul>
          <li> <code class = "inline">df</code>: a DataFrame containing <a href="https://data.cityofnewyork.us/Transportation/2020-For-Hire-Vehicles-Trip-Data/m3yx-mvk4">Yellow Taxi Trip Data</a> from OpenData NYC.
        </ul>
        The function computes 3 new columns:
        <ul>
          <li><code class = "inline">percent_tip</code>: which is <code class="inline">100*tip_amount/(total_amount-tip_amount)</code>
          <li><code class = "inline">duration</code>: the time the trip took in seconds.
          <li><code class = "inline">dayofweek</code>: the day of the week that the trip started, represented as 0 for Monday, 1 for Tuesday, ... 6 for Sunday.
        </ul>
        The original DataFrame with these additional three columns is returned.  (Note this is identical to the function with the same name in <a href="p8.html">Program 8</a>.  You may use your earlier function or the Program 8 solution available on Blackboard.)

    <li> ADD BORO


    <li> <code class = "inline">split_columns_by_data_type(df) -> dict:</code>
      """
      Separate out raw df into y, numerical x columns, and categorical x columns
      :param df: pandas dataframe, output of import_data()
      :return: a dictionary of lists
      """


    <li> <code class = "inline">impute_numeric_cols(df, x_num_cols) -> pd.DataFrame:</code>
      """
      For numeric columns, impute missing data with the median
      :param df: pandas dataframe, output of import_data()
      :param x_num_cols: list of numerical X columns, output of application of split_columns_by_data_type()
      :return: pandas dataframe containing imputed numerical columns from input df
      """

      FROM BEFORE-- move to top?

    <li> <code class = "inline">transform_numeric_cols(df_num_imputed, degree_num=2) -> pd.DataFrame:</code>
      """
      :param df_num_imputed:
      :param degree_num:
      :return:
      """

      FROM BEFORE-- move to top?


    <li> <code class = "inline">impute_categorical_cols(df, x_cat_cols) -> pd.DataFrame:</code>
      """
      For categorical columns, impute missing data with the most common value
      :param df: pandas dataframe, output of import_data()
      :param x_cat_cols: list of categorical X columns, output of application of split_columns_by_data_type()
      :return: pandas dataframe containing imputed categorical columns from input df
      """


    <li> <code class = "inline">encode_categorical_cols(df_cat_imputed) -> pd.DataFrame:</code>
      """
      One hot encode categorical columns, remove first variable, to get k-1 dummies out of k categorical levels
      :param df_cat_imputed: pandas dataframe, output of impute_categorical_cols()
      :return: pandas dataframe containing the one hot encoded categorical dataframe
      """


    <li> <code class = "inline">split_test_train(df, y_col_name, df_cat_encoded, df_num_imputed, df_num_transformed,
                       test_size=0.25, random_state=12345) -> Union[pd.DataFrame, pd.Series()]:</code>
      """
      :param df:
      :param y_col_name:
      :param df_cat_encoded:
      :param df_num_imputed:
      :param df_num_transformed:
      :param test_size:
      :param random_state:
      :return:
      """



    <li> <code class = "inline">fit_linear_regression(x_train, y_train):</code>
      """
      :param x_train:
      :param y_train:
      :return:
      """


    <li> <code class = "inline">predict_using_trained_model(mod, x, y):</code>
      """
      In testing code, run this twice!  to evaluate mse and r2 and see diff between
      apply to training dataset versus testing dataset
      :param mod:
      :param x:
      :param y:
      :return:
      """



    <li> <code class = "inline">ouput_model(mod):</code>
      # [SS] not sure how to write an Autograder test for this, thoughts?
      dump(mod, 'mod.joblib')


    <li> <code class = "inline">load_model(mod_filename):</code>
      # [SS] not sure how to write an Autograder test for this, thoughts?
      mod = load(mod_filename)
      return mod

</ul>


    <p>For example, if the file, <a href="taxi_new_years_day_2020.csv">taxi_new_years_day_2020.csv</a>, was the first of January 2020 entries downloaded from <a href="https://data.cityofnewyork.us/Transportation/2020-For-Hire-Vehicles-Trip-Data/m3yx-mvk4">Yellow Taxi Trip Data</a> (about 170,000 entries) with the first 3 lines of:
      <pre><code class="datablock">VendorID,tpep_pickup_datetime,tpep_dropoff_datetime,passenger_count,trip_distance,RatecodeID,store_and_fwd_flag,PULocationID,DOLocationID,payment_type,fare_amount,extra,mta_tax,tip_amount,tolls_amount,improvement_surcharge,total_amount,congestion_surcharge
      1,01/01/2020 12:00:00 AM,01/01/2020 12:13:03 AM,1,2.2,1,N,68,170,1,10.5,3,0.5,2.85,0,0.3,17.15,2.5
      2,01/01/2020 12:00:00 AM,01/01/2020 01:08:55 AM,5,1.43,1,N,48,239,2,6.5,0.5,0.5,0,0,0.3,10.3,2.5
      </code></pre>
        Then a sample run of the program:
      <pre><code class="blockcode">Enter input file name: taxi_new_years_day2020.csv
      Enter output file name:  taxi_Jan2020_with_percents.csv
      </code></pre>

        And the first three lines of <tt>taxi_Jan2020_with_percents.csv</tt> would be:
      <pre><code class="datablock">VendorID,tpep_pickup_datetime,tpep_dropoff_datetime,passenger_count,trip_distance,RatecodeID,store_and_fwd_flag,PULocationID,DOLocationID,payment_type,fare_amount,extra,mta_tax,tip_amount,tolls_amount,improvement_surcharge,total_amount,congestion_surcharge,percent_tip,percent_fare
      1.0,01/01/2020 12:00:00 AM,01/01/2020 12:13:03 AM,1.0,2.2,1.0,N,68,170,1.0,10.5,3.0,0.5,2.85,0.0,0.3,17.15,2.5,27.1,61.2
      2.0,01/01/2020 12:00:00 AM,01/01/2020 01:08:55 AM,5.0,1.43,1.0,N,48,239,2.0,6.5,0.5,0.5,0.0,0.0,0.3,10.3,2.5,0.0,63.1
      </code></pre>
        <p> You should round the values stored in your new columns to the nearest tenth and save your CSV file without the indexing (i.e. <code class="inline">index=False</code>).

      </p>



</div>
</body>
</html>
